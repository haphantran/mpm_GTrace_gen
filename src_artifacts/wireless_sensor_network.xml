<?xml version="1.0" encoding="utf-8"?>
<mpm_trace:Canvas xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:mpm_trace="domain://MPM_trace">

  <!-- ========== METAMODELS ========== -->

  <!-- [0] Base Metamodel -->
  <nodes xmi:type="mpm_trace:MetaModel" name="Ecore"/>

  <!-- [1] Transformation Metamodel -->
  <nodes xmi:type="mpm_trace:MetaModel" name="ATL"/>

  <!-- [2] Trace Metamodel -->
  <nodes xmi:type="mpm_trace:MetaModel" name="LTrace" conformsTo="//@nodes.0"/>

  <!-- [3] Domain Metamodels -->
  <nodes xmi:type="mpm_trace:MetaModel" name="GlobalViewMM" conformsTo="//@nodes.0"/>
  <nodes xmi:type="mpm_trace:MetaModel" name="PSMM" conformsTo="//@nodes.0"/>
  <nodes xmi:type="mpm_trace:MetaModel" name="SystemDiagramMM" conformsTo="//@nodes.0"/>
  <nodes xmi:type="mpm_trace:MetaModel" name="CodeMM" conformsTo="//@nodes.0"/>

  <!-- ========== VIEWPOINTS ========== -->

  <!-- [7] -->
  <nodes xmi:type="mpm_trace:Viewpoint" name="NetworkViewpoint"/>

  <!-- [8] -->
  <nodes xmi:type="mpm_trace:Viewpoint" name="SensorDataViewpoint"/>

  <!-- ========== ROLES ========== -->

  <!-- [9] -->
  <nodes xmi:type="mpm_trace:Network_Engineer" name="NetworkEngineer"/>

  <!-- [10] -->
  <nodes xmi:type="mpm_trace:IoT_Engineer" name="IoTEngineer"/>

  <!-- [11] -->
  <nodes xmi:type="mpm_trace:Embedded_System_Engineer" name="EmbeddedSystemEngineer"/>

  <!-- ========== MODELS ========== -->

  <!-- [12] L0 Input: GlobalView Model -->
  <nodes xmi:type="mpm_trace:Model" name="GlobalView"
         conformsTo="//@nodes.3"
         associatedWith="//@nodes.10"
         In="//@nodes.15 //@nodes.16 //@nodes.17"/>

  <!-- [13] L0 Output: Arduino PSM -->
  <nodes xmi:type="mpm_trace:Model" name="Arduino_PSM"
         conformsTo="//@nodes.4"
         representedAs="//@nodes.7 //@nodes.8"
         associatedWith="//@nodes.11"
         In="//@nodes.19 //@nodes.22"/>

  <!-- [14] L0 Output: RIOT PSM -->
  <nodes xmi:type="mpm_trace:Model" name="RIOT_PSM"
         conformsTo="//@nodes.4"
         representedAs="//@nodes.7 //@nodes.8"
         associatedWith="//@nodes.11"
         In="//@nodes.19 //@nodes.23"/>

  <!-- ========== L0 TRANSFORMATIONS (GlobalView → PSMs) ========== -->

  <!-- [15] L0: GlobalView → Arduino (with 2 executions) -->
  <nodes xmi:type="mpm_trace:Transformation" name="GenArduino"
         conformsTo="//@nodes.4"
         Out="//@nodes.13"
         exec="//@nodes.25 //@nodes.26"/>

  <!-- [16] L0: GlobalView → RIOT (with 2 executions) -->
  <nodes xmi:type="mpm_trace:Transformation" name="GenRIOT"
         conformsTo="//@nodes.4"
         Out="//@nodes.14"
         exec="//@nodes.27 //@nodes.28"/>

  <!-- [17] L0: GlobalView → Contiki -->
  <nodes xmi:type="mpm_trace:Transformation" name="GenContiki"
         conformsTo="//@nodes.4"
         Out="//@nodes.18"
         exec="//@nodes.36"/>

  <!-- [18] L0 Output: Contiki PSM -->
  <nodes xmi:type="mpm_trace:Model" name="Contiki_PSM"
         conformsTo="//@nodes.4"
         representedAs="//@nodes.7 //@nodes.8"
         associatedWith="//@nodes.11"
         In="//@nodes.19 //@nodes.24"/>

  <!-- ========== L1 MODEL (System Diagram Integration) ========== -->

  <!-- [19] L1: PSMs → System Diagram -->
  <nodes xmi:type="mpm_trace:Transformation" name="PSM2SystemDiagram"
         conformsTo="//@nodes.0"
         Out="//@nodes.20"
         exec="//@nodes.29"/>

  <!-- [20] L1 Output: System Diagram (integration point) -->
  <nodes xmi:type="mpm_trace:Model" name="SystemDiagram"
         conformsTo="//@nodes.5"
         associatedWith="//@nodes.9"/>

  <!-- ========== L2 OUTPUT MODELS (Code) ========== -->

  <!-- [21] L2 Output: Arduino C Code -->
  <nodes xmi:type="mpm_trace:Model" name="Arduino_C_Code"
         conformsTo="//@nodes.6"
         associatedWith="//@nodes.11"/>

  <!-- ========== L2 TRANSFORMATIONS (PSMs → Code) ========== -->

  <!-- [22] L2: Arduino PSM → Arduino C Code -->
  <nodes xmi:type="mpm_trace:Transformation" name="Arduino2Code"
         conformsTo="//@nodes.1"
         Out="//@nodes.21"
         exec="//@nodes.38"/>

  <!-- [23] L2: RIOT PSM → RIOT C Code -->
  <nodes xmi:type="mpm_trace:Transformation" name="RIOT2Code"
         conformsTo="//@nodes.1"
         Out="//@nodes.30"
         exec="//@nodes.31"/>

  <!-- [24] L2: Contiki PSM → Contiki C Code -->
  <nodes xmi:type="mpm_trace:Transformation" name="Contiki2Code"
         conformsTo="//@nodes.1"
         Out="//@nodes.41"
         exec="//@nodes.43"/>

  <!-- ========== L0 EXECUTIONS ========== -->

  <!-- [25] L0 Execution V1: GenArduino -->
  <nodes xmi:type="mpm_trace:TransformationExecution" name="Exec_GenArduino_v1"
         generates="//@nodes.32"/>

  <!-- [26] L0 Execution V2: GenArduino -->
  <nodes xmi:type="mpm_trace:TransformationExecution" name="Exec_GenArduino_v2"
         generates="//@nodes.33"/>

  <!-- [27] L0 Execution V1: GenRIOT -->
  <nodes xmi:type="mpm_trace:TransformationExecution" name="Exec_GenRIOT_v1"
         generates="//@nodes.34"/>

  <!-- [28] L0 Execution V2: GenRIOT -->
  <nodes xmi:type="mpm_trace:TransformationExecution" name="Exec_GenRIOT_v2"
         generates="//@nodes.35"/>

  <!-- [29] L1 Execution V1: PSM2SystemDiagram -->
  <nodes xmi:type="mpm_trace:TransformationExecution" name="Exec_PSM2SD_v1"
         generates="//@nodes.42"/>

  <!-- [30] L2 Output: RIOT C Code -->
  <nodes xmi:type="mpm_trace:Model" name="RIOT_C_Code"
         conformsTo="//@nodes.6"
         associatedWith="//@nodes.11"/>

  <!-- [31] L2 Execution V1: RIOT → C Code -->
  <nodes xmi:type="mpm_trace:TransformationExecution" name="Exec_RIOT2C_v1"
         generates="//@nodes.40"/>

  <!-- ========== L0 TRACES ========== -->

  <!-- [32] L0 Trace V1: Arduino (detailed example) -->
  <nodes xmi:type="mpm_trace:TraceModel" name="Trace_GenArduino_v1"
         conformsTo="//@nodes.2"
         version="1">
    <contains name="ConfigureWiFiNetwork">
      <intents name="NetworkConfiguration">
        <params name="connectivity = WiFi"/>
      </intents>
      <traceLinks name="SensorNode -> WiFiBoard"/>
    </contains>
  </nodes>

  <!-- [33] L0 Trace V2: Arduino (ancestor: v1) -->
  <nodes xmi:type="mpm_trace:TraceModel" name="Trace_GenArduino_v2"
         conformsTo="//@nodes.2"
         version="2"
         ancestor="//@nodes.32"/>

  <!-- [34] L0 Trace V1: RIOT (simplified) -->
  <nodes xmi:type="mpm_trace:TraceModel" name="Trace_GenRIOT_v1"
         conformsTo="//@nodes.2"
         version="1"/>

  <!-- [35] L0 Trace V2: RIOT (ancestor: v1) -->
  <nodes xmi:type="mpm_trace:TraceModel" name="Trace_GenRIOT_v2"
         conformsTo="//@nodes.2"
         version="2"
         ancestor="//@nodes.34"/>

  <!-- [36] L0 Execution V1: GenContiki -->
  <nodes xmi:type="mpm_trace:TransformationExecution" name="Exec_GenContiki_v1"
         generates="//@nodes.37"/>

  <!-- [37] L0 Trace V1: Contiki (simplified) -->
  <nodes xmi:type="mpm_trace:TraceModel" name="Trace_GenContiki_v1"
         conformsTo="//@nodes.2"
         version="1"/>

  <!-- [38] L2 Execution V1: Arduino → C Code -->
  <nodes xmi:type="mpm_trace:TransformationExecution" name="Exec_Arduino2C_v1"
         generates="//@nodes.39"/>

  <!-- [39] L2 Trace V1: Arduino → C Code (detailed example) -->
  <nodes xmi:type="mpm_trace:TraceModel" name="Trace_Arduino2C_v1"
         conformsTo="//@nodes.2"
         version="1">
    <contains name="GenerateCCode">
      <intents name="Model2Text">
        <params name="language = C"/>
        <params name="template = arduino_sensor.c"/>
      </intents>
      <traceLinks name="ArduinoNodes -> setup() function"/>
      <traceLinks name="SensorReading -> loop() function"/>
    </contains>
  </nodes>

  <!-- [40] L2 Trace V1: RIOT → C Code (simplified) -->
  <nodes xmi:type="mpm_trace:TraceModel" name="Trace_RIOT2C_v1"
         conformsTo="//@nodes.2"
         version="1"/>

  <!-- [41] L2 Output: Contiki C Code -->
  <nodes xmi:type="mpm_trace:Model" name="Contiki_C_Code"
         conformsTo="//@nodes.6"
         associatedWith="//@nodes.11"/>

  <!-- [42] L1 Trace V1: PSM to System Diagram (detailed example) -->
  <nodes xmi:type="mpm_trace:TraceModel" name="Trace_PSM2SD_v1"
         conformsTo="//@nodes.2"
         version="1">
    <contains name="IntegrateMultiPlatform">
      <intents name="SystemIntegration">
        <params name="topology = mesh"/>
      </intents>
      <traceLinks name="Arduino_PSM -> ArduinoNodes"/>
      <traceLinks name="RIOT_PSM -> RIOTNodes"/>
      <traceLinks name="Contiki_PSM -> ContikiNodes"/>
    </contains>
  </nodes>

  <!-- [43] L2 Execution V1: Contiki → C Code -->
  <nodes xmi:type="mpm_trace:TransformationExecution" name="Exec_Contiki2C_v1"
         generates="//@nodes.44"/>

  <!-- [44] L2 Trace V1: Contiki → C Code (simplified) -->
  <nodes xmi:type="mpm_trace:TraceModel" name="Trace_Contiki2C_v1"
         conformsTo="//@nodes.2"
         version="1"/>

</mpm_trace:Canvas>
